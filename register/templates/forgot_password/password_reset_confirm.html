{% extends 'a_classroom/base.html' %}
{% load static tailwind_tags %}
{% block title %}Set New Password{% endblock %}
{% tailwind_css %}
{% block content %}

<div class="flex items-center justify-center w-full h-full px-4 bg-white sm:px-6 lg:px-8">
    <div class="flex items-center justify-center w-full max-w-md p-6 bg-white border border-gray-300 shadow-xl rounded-xl sm:max-w-lg md:max-w-2xl lg:max-w-3xl xl:max-w-4xl sm:p-8 md:p-10 lg:p-12">
        
        <form method="POST" class="w-full flex flex-col gap-4" novalidate>
            {% csrf_token %}
            
            <h2 class="text-center text-2xl font-semibold text-gray-900">Set New Password</h2>
            
            <p class="text-sm text-center text-gray-500 sm:text-base lg:text-lg">
                Please enter your new password twice so we can verify you typed it in correctly.
            </p>

            <!-- New Password -->
            <div class="flex flex-col w-full gap-1 sm:gap-2">
                <label for="id_new_password1" class="text-sm font-medium text-gray-800 sm:text-base">
                    New Password
                </label>
                <div class="relative">
                  <input type="password" name="new_password1" id="id_new_password1"
                         class="w-full h-10 pr-10 sm:h-12 px-3 sm:px-4 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-black"
                         placeholder="Enter new password" required>
                  <button type="button" id="toggle_new_password1" aria-label="Toggle new password visibility"
                          class="absolute inset-y-0 right-0 flex items-center pr-3 p-2 text-gray-600 hover:text-gray-800 focus:outline-none z-20">
                    <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 icon-show" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                    </svg>
                    <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 icon-hide hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.542-7a9.97 9.97 0 012.223-3.477M6.18 6.18A9.969 9.969 0 0112 5c4.478 0 8.268 2.943 9.542 7a9.964 9.964 0 01-1.05 2.266M3 3l18 18" />
                    </svg>
                  </button>
                </div>
                {% if form.new_password1.errors %}
                    <div class="text-sm text-red-600">
                        {{ form.new_password1.errors }}
                    </div>
                {% endif %}
            </div>

            <!-- Confirm Password -->
            <div class="flex flex-col w-full gap-1 sm:gap-2">
                <label for="id_new_password2" class="text-sm font-medium text-gray-800 sm:text-base">
                    Confirm Password
                </label>
                <div class="relative">
                  <input type="password" name="new_password2" id="id_new_password2"
                         class="w-full h-10 pr-10 sm:h-12 px-3 sm:px-4 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-black"
                         placeholder="Confirm new password" required>
                  <button type="button" id="toggle_new_password2" aria-label="Toggle confirm password visibility"
                          class="absolute inset-y-0 right-0 flex items-center pr-3 p-2 text-gray-600 hover:text-gray-800 focus:outline-none z-20">
                    <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 icon-show" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                    </svg>
                    <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 icon-hide hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.542-7a9.97 9.97 0 012.223-3.477M6.18 6.18A9.969 9.969 0 0112 5c4.478 0 8.268 2.943 9.542 7a9.964 9.964 0 01-1.05 2.266M3 3l18 18" />
                    </svg>
                  </button>
                </div>
                {% if form.new_password2.errors %}
                    <div class="text-sm text-red-600">
                        {{ form.new_password2.errors }}
                    </div>
                {% endif %}
            </div>


            <div class="flex items-center gap-2 text-sm self-start">
                <input id="show_password_checkbox_reset" type="checkbox" class="h-4 w-4 text-black focus:ring-black border-gray-300" />
                <label for="show_password_checkbox_reset" class="text-gray-700 select-none">Show Password</label>
            </div>

            <!-- Button -->
            <button type="submit" 
                    class="w-full px-4 py-2 text-sm sm:text-base md:text-lg text-white bg-black rounded-md shadow-lg hover:bg-gray-800 transition-colors cursor-pointer">
                Change Password
            </button>
        </form>
    </div>
</div>

<script>
// Password visibility for reset form
function togglePasswordReset(inputId, btnId) {
  const input = document.getElementById(inputId);
  const btn = document.getElementById(btnId);
  if (!input || !btn) return;
  const showIcon = btn.querySelector('.icon-show');
  const hideIcon = btn.querySelector('.icon-hide');
  if (input.type === 'password') {
    input.type = 'text';
    if (showIcon) showIcon.classList.add('hidden');
    if (hideIcon) hideIcon.classList.remove('hidden');
  } else {
    input.type = 'password';
    if (showIcon) showIcon.classList.remove('hidden');
    if (hideIcon) hideIcon.classList.add('hidden');
  }
}

document.addEventListener('DOMContentLoaded', function () {
  const t1 = document.getElementById('toggle_new_password1');
  const t2 = document.getElementById('toggle_new_password2');
  const cb = document.getElementById('show_password_checkbox_reset');
  const i1 = document.getElementById('id_new_password1');
  const i2 = document.getElementById('id_new_password2');
  if (t1) { t1.setAttribute('type','button'); t1.addEventListener('click', function(e){ e.preventDefault(); togglePasswordReset('id_new_password1','toggle_new_password1'); if (cb) cb.checked = (i1.type==='text'); }); }
  if (t2) { t2.setAttribute('type','button'); t2.addEventListener('click', function(e){ e.preventDefault(); togglePasswordReset('id_new_password2','toggle_new_password2'); if (cb) cb.checked = (i2.type==='text'); }); }
  if (cb) {
    cb.addEventListener('change', function(){
      const checked = cb.checked;
      if (i1) i1.type = checked ? 'text' : 'password';
      if (i2) i2.type = checked ? 'text' : 'password';
      const show1 = t1?.querySelector('.icon-show'); const hide1 = t1?.querySelector('.icon-hide');
      const show2 = t2?.querySelector('.icon-show'); const hide2 = t2?.querySelector('.icon-hide');
      if (checked) { if (show1) show1.classList.add('hidden'); if (hide1) hide1.classList.remove('hidden'); if (show2) show2.classList.add('hidden'); if (hide2) hide2.classList.remove('hidden'); }
      else { if (show1) show1.classList.remove('hidden'); if (hide1) hide1.classList.add('hidden'); if (show2) show2.classList.remove('hidden'); if (hide2) hide2.classList.add('hidden'); }
    });
  }
});
</script>

{% endblock %}