<!-- Previous-->
<div class="flex flex-row w-full h-full border-2 border-solid bg-gray-200">
    <!-- Previous -->
    <div class="flex justify-center items-center border-solid h-full w-[10%] bg-gray-200 text-sm font-medium text-gray-800 sm:text-base">
        <form hx-get="{% url 'a_classroom:prev_or_next' %}" hx-target="#output" hx-swap="innerHTML">
            <input type="hidden" name="activity_id" value="{{ activity.activity_id }}">
            <input type="hidden" name="index" value="{{ index }}">
            <button type="submit" name="action" value="previous" 
            class="flex items-center justify-center w-20 h-12 text-white bg-black border-2 border-solid shadow-xl cursor-pointer rounded-xl hover:bg-gray-500"
                hx-target="#output" hx-swap="innerHTML" title="Go to previous page">Previous</button> 
        </form>
    </div>

    <!-- Submission Details -->
    <div class="relative w-full h-full bg-gray-200 min-h-0">
        <!-- Scrollable content area -->
        <div class="h-full overflow-y-auto pt-6 pl-4 pr-4 pb-28 min-h-0" style="scrollbar-gutter: stable;">
            {% if submission %}

                <div class="pb-3 text-left text-sm font-medium text-gray-800 sm:text-base">
                    <span class="font-bold">Email Address</span>
                    <div class="mb-4 p-3 bg-gray-100 rounded-lg max-h-80 overflow-y-auto" style="scrollbar-gutter: stable;">
                        {{ submission.student.email }}
                    </div>
                </div>

                <p class="b-3 text-left text-sm font-medium text-gray-800 sm:text-base">
                    <span class="font-bold">Submitted Code</span>
                    <pre class="mb-4 p-3 bg-gray-100 rounded-lg min-h-24 max-h-80 overflow-y-auto">{{ submission.submitted_code }}</pre>
                </p>

                <!-- Editable Feedback with scrollable content -->
                <div id="feedback-{{ submission.id }}" class="pb-3 text-left text-sm font-medium text-gray-800 sm:text-base">
                    <span class="font-bold">Feedback</span>
                    <div class="mb-4 p-3 bg-gray-100 rounded-lg min-h-48 max-h-80 overflow-y-auto" style="scrollbar-gutter: stable;">
                        {{ submission.feedback }}
                        <button class="ml-3 mt-3 md:ml-3 md:mt-0 px-3 py-1 text-sm font-medium sm:text-base text-white bg-blue-600 rounded-lg shadow hover:bg-blue-800 transition-colors duration-200 {% if first_submission.status == 'returned' %} opacity-50 cursor-not-allowed bg-gray-500 {% endif %}"
                            hx-get="{% url 'c_activities:edit-insight' submission.id %}"
                            hx-swap="outerHTML"
                            hx-target="#feedback-{{ submission.id }}"
                            title="Click to edit feedback"
                            {% if submission.status == 'returned' %} disabled {% endif %}>Edit Feedback</button>
                    </div>
                </div>

                <div id="score-{{ submission.id }}" class="pb-3 text-left text-sm font-medium text-gray-800 sm:text-base">
                    <span class="font-bold">Score</span>
                    <div class="p-3 bg-gray-100 rounded-lg max-h-20 overflow-y-auto" style="scrollbar-gutter: stable;"> 
                        {{ submission.score }}
                        <button class="ml-3 px-3 py-1 text-sm text-sm font-medium sm:text-base text-white bg-green-600 rounded-lg shadow hover:bg-green-800 transition-colors duration-200 {% if submission.status == 'returned' %} opacity-50 cursor-not-allowed bg-gray-500 {% endif %}"
                            hx-get="{% url 'c_activities:edit-grade' submission.id %}" 
                            hx-swap="outerHTML" 
                            hx-target="#score-{{ submission.id }}" 
                            title="Click to edit grade"
                            {% if submission.status == 'returned' %} disabled {% endif %}>Edit Grade</button>
                    </div>
                </div>

                <!-- Return Grade button placed directly under the score -->
                <form hx-post="{% url 'c_activities:return-grade' submission.id %}" class="mt-2">
                    {% csrf_token %}
                    <button type="submit" name="action" value="return" 
                    class="flex items-center text-sm font-medium text-gray-800 sm:text-base justify-center w-40 h-12 text-white bg-black border-2 border-solid shadow-xl rounded-xl {% if submission.status == 'returned' %}opacity-50 cursor-not-allowed bg-gray-500{% else %}cursor-pointer hover:bg-gray-500{% endif %}" 
                    title="{% if submission.status == 'returned' %}Grade already returned{% else %}Click to return grade to student{% endif %}" 
                    {% if submission.status == 'returned' %}disabled onclick="return false;"{% endif %}>
                        Return Grade
                    </button>
                </form>
            {% else %}
                <p class="text-center text-lg text-sm font-medium text-gray-800 sm:text-base">No submission.</p>
            {% endif %}
        </div>

        <!-- Fixed Return Grade Button (not scrollable) -->
        {% if submission %}
            <div class="absolute bottom-4 left-1/2 transform -translate-x-1/2 w-full flex justify-center">
                <form hx-post="{% url 'c_activities:return-grade' submission.id %}">
                    {% csrf_token %}
                    <button type="submit" name="action" value="return" 
                    class="flex items-center justify-center w-40 h-12 text-white bg-black border-2 border-solid shadow-xl rounded-xl {% if submission.status == 'returned' %}opacity-50 cursor-not-allowed bg-gray-500{% else %}cursor-pointer hover:bg-gray-500{% endif %}" 
                    title="{% if submission.status == 'returned' %}Grade already returned{% else %}Click to return grade to student{% endif %}" 
                    {% if submission.status == 'returned' %}disabled onclick="return false;"{% endif %}>
                        Return Grade
                    </button>
                </form>
            </div>
        {% endif %}
    </div>

    <!-- Next -->
    <div class="flex justify-center items-center border-solid h-full w-[10%] bg-gray-200 text-sm font-medium text-gray-800 sm:text-base">
        <form hx-get="{% url 'a_classroom:prev_or_next' %}" hx-target="#output" hx-swap="innerHTML">
            <input type="hidden" name="activity_id" value="{{ activity.activity_id }}">
            <input type="hidden" name="index" value="{{ index }}">
            <button type="submit" name="action" value="next" 
            class="flex items-center justify-center w-20 h-12 text-white bg-black border-2 border-solid shadow-xl cursor-pointer rounded-xl hover:bg-gray-500"
                hx-target="#output" hx-swap="innerHTML" title="Go to next page">Next</button> 
        </form>
    </div>
</div>